(()=>{var t={n:n=>{var r=n&&n.__esModule?()=>n.default:()=>n;return t.d(r,{a:r}),r},d:(n,r)=>{for(var s in r)t.o(r,s)&&!t.o(n,s)&&Object.defineProperty(n,s,{enumerable:!0,get:r[s]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n);const r=flarum.core.compat.app;var s=t.n(r);const a=flarum.core.compat["components/NotificationGrid"];var e=t.n(a);flarum.core;const o=flarum.core.compat.extend,i=flarum.core.compat["models/User"];var c=t.n(i);const u=flarum.core.compat.Model;var l=t.n(u);const p=flarum.core.compat["utils/PostControls"];var d=t.n(p);const h=flarum.core.compat["utils/UserControls"];var f=t.n(h);const g=flarum.core.compat["components/Button"];var v=t.n(g);function w(t,n){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},w(t,n)}function b(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,w(t,n)}const y=flarum.core.compat["components/Modal"];var _=t.n(y);const k=flarum.core.compat["helpers/username"];var C=t.n(k);const N=flarum.core.compat["utils/Stream"];var W=t.n(N);const P=flarum.core.compat["common/components/Switch"];var L=t.n(P);const A=flarum.core.compat["common/components/Select"];var x=t.n(A);const O=flarum.core.compat["forum/app"];var I=t.n(O),U=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.oninit=function(n){var r=this;t.prototype.oninit.call(this,n),this.publicComment=W()(""),this.privateComment=W()(""),this.strikes=W()(0),this.money=W()(0),this.isRemoveLottery=W()(!1),this.snippets=I().forum.attribute("moderate-warnings.snippet")||{},this.snippetsSelect={},Object.keys(this.snippets).forEach((function(t){r.snippetsSelect[r.snippets[t]]=t}))},r.className=function(){return"WarningsModal Modal--large"},r.title=function(){return I().translator.trans("askvortsov-moderator-warnings.forum.warning_modal.heading",{username:C()(this.attrs.user)})},r.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m("div",null,m("label",null,I().translator.trans("askvortsov-moderator-warnings.forum.warning_modal.strikes_heading")),m("input",{type:"number",className:"FormControl",bidi:this.strikes,min:"0",max:"5"}))),m("div",{className:"Form-group"},m("div",null,m("label",null,"扣多少能量？"),m("input",{type:"number",className:"FormControl",bidi:this.money,min:"0",max:"100"}))),m("div",{className:"Form-group"},m("div",null,m("label",null,I().translator.trans("askvortsov-moderator-warnings.forum.warning_modal.public_comment_heading",{username:C()(this.attrs.user)})),m(x(),{className:"FormControl",options:this.snippetsSelect,onchange:this.setPublicCommentFromData.bind(this)},I().translator.trans("askvortsov-moderator-warnings.forum.snippet")),m("textarea",{className:"FormControl",bidi:this.publicComment,required:!0,rows:"6"}))),m("div",{className:"Form-group"},m("div",null,m("label",null,I().translator.trans("askvortsov-moderator-warnings.forum.warning_modal.private_comment_heading",{username:C()(this.attrs.user)})),m("textarea",{className:"FormControl",bidi:this.privateComment,rows:"6"}))),m("div",{className:"Form-group"},m(L(),{state:this.isRemoveLottery(),onchange:this.isRemoveLottery},"移除用户所有抽奖？")),m("div",{className:"Form-group"},m(v(),{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},I().translator.trans("askvortsov-moderator-warnings.forum.warning_modal.submit_button")))))},r.setPublicCommentFromData=function(t){this.publicComment(t)},r.setPublicComment=function(t){switch(t){case"water_warning":this.publicComment("你好，你发布的内容符合版规【可讨论内容】第一条中“恶意水帖”一项，现对你进行警告并扣除相应能量，请自觉遵守相关版规要求参与论坛讨论，感谢你的配合！");break;case"remove_lottery":this.publicComment("你好，你发布的内容符合版规【可讨论内容】第一条中“恶意水帖”一项，现对你进行警告并扣除相应能量，且你所参与抽奖已被移除，请满足条件后再重新参与！");break;case"tag_error_warning":this.publicComment("你好，你发布的帖子选择标签错误，管理已为你更改标签，现对你进行警告并扣除相应能量，请在发帖时选择与您帖子内容相关的专业标签，以确保帖子能够得到正确的关注与回复，感谢你的配合！");break;case"verification_warning":this.publicComment("你好，你发布的内容符合版规【可讨论内容】第一条中“涉政”一项，现对你进行警告并扣除相应能量，请不要讨论部分敏感话题，感谢你的配合！");break;case"attack_warning":this.publicComment("你好，你发布的内容符合版规【可讨论内容】第一条中“攻击他人或引战”一项，现对你进行警告并扣除相应能量，请心平气和友好交流，维护和谐的论坛环境，感谢你的配合！");break;case"uncomfortable_warning":this.publicComment("你好，你发布的内容符合版规【可讨论内容】第一条中“发表无意义内容”一项，现对你进行警告并扣除相应能量，请发表高质量内容，互相交流学习，感谢你的配合！");break;case"notrue_warning":this.publicComment("你好，你发布的内容符合版规【可讨论内容】第一条中“扭曲事实”一项，现对你进行警告并扣除相应能量，网络信息真真假假难以分辨，请仔细辨别内容真实性再发布，感谢你的配合！");break;case"ai_warning":this.publicComment("你好，你发布的内容疑似机器人或ai发布，现对你进行警告并扣除相应能量，感谢你的配合！！");break;default:this.publicComment("")}},r.onsubmit=function(t){t.preventDefault(),I().alerts.dismiss(this.successAlert),this.loading=!0,this.strikes()||this.strikes(0),this.money()||this.money(0);var n={userId:this.attrs.user.id(),strikes:this.strikes(),money:this.money(),isRemoveLottery:this.isRemoveLottery(),public_comment:this.publicComment(),private_comment:this.privateComment()};this.attrs.post&&(n.post=this.attrs.post),I().store.createRecord("warnings").save(n).then(this.hide.bind(this)).then(this.successAlert=I().alerts.show({type:"success"},I().translator.trans("askvortsov-moderator-warnings.forum.warning_modal.confirmation_message"))).then(this.attrs.callback).catch((function(){}))},n}(_());const B=flarum.core.compat["components/UserPage"];var M=t.n(B);const F=flarum.core.compat["components/LinkButton"];var S=t.n(F);function j(){return j=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},j.apply(this,arguments)}const D=flarum.core.compat.Component;var H=t.n(D);const T=flarum.core.compat["components/LoadingIndicator"];var R=t.n(T);const V=flarum.core.compat["components/Dropdown"];var E=t.n(V);const z=flarum.core.compat["components/Link"];var q=t.n(z);const G=flarum.core.compat["helpers/avatar"];var J=t.n(G);const K=flarum.core.compat["helpers/humanTime"];var Q=t.n(K);const X=flarum.core.compat["utils/classList"];var Y=t.n(X);const Z=flarum.core.compat["components/PostPreview"];var tt=t.n(Z),nt=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.view=function(){return m("div",{className:"WarningPost"},m("ul",{class:"Dropdown-menu PostPreview-preview fade in"},m("li",null,tt().component({post:this.attrs.post}))))},r.oncreate=function(n){t.prototype.oncreate.call(this,n),this.$(".PostPreview-preview").show().css("position","relative")},n}(H());const rt=flarum.core.compat["components/Separator"];var st=t.n(rt);const at=flarum.core.compat["utils/ItemList"];var et=t.n(at);const ot={controls:function(t,n){var r=this,s=new(et());return["user","moderation","destructive"].forEach((function(a){var e=r[a+"Controls"](t,n).toArray();e.length&&(e.forEach((function(t){return s.add(t.itemName,t)})),s.add(a+"Separator",st().component()))})),s},userControls:function(t,n){return new(et())},moderationControls:function(t,n){return new(et())},destructiveControls:function(t,n){var r=new(et());return!t.isHidden()&&app.session.user.canManageWarnings()&&r.add("hide",m(v(),{icon:"far fa-trash-alt",onclick:this.hideAction.bind(t)},app.translator.trans("askvortsov-moderator-warnings.forum.warning_controls.delete_button"))),t.isHidden()&&app.session.user.canManageWarnings()&&r.add("restore",m(v(),{icon:"fas fa-reply",onclick:this.restoreAction.bind(t)},app.translator.trans("askvortsov-moderator-warnings.forum.warning_controls.restore_button"))),t.isHidden()&&app.session.user.canDeleteWarnings()&&r.add("delete",m(v(),{icon:"fas fa-times",onclick:this.deleteAction.bind(t)},app.translator.trans("askvortsov-moderator-warnings.forum.warning_controls.delete_forever_button"))),r},hideAction:function(){return this.pushAttributes({hiddenAt:new Date,hiddenUser:app.session.user}),this.save({isHidden:!0}).then((function(){return m.redraw()}))},restoreAction:function(){return this.pushAttributes({hiddenAt:null,hiddenUser:null}),this.save({isHidden:!1}).then((function(){return m.redraw()}))},deleteAction:function(t){return t&&(t.loading=!0),this.delete().then((function(){})).catch((function(){})).then((function(){t&&(t.loading=!1),location.reload()}))}};var it=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.view=function(){var t=this.attrs.warning,n=t.addedByUser(),r=ot.controls(t,this).toArray();return m("div",this.elementAttrs(),r.length?E().component({icon:"fas fa-ellipsis-v",className:"WarningListItem-controls",buttonClassName:"Button Button--icon Button--flat Slidable-underneath Slidable-underneath--right"},r):"",m("div",{className:"WarningListItem-main"},m("h3",{className:"WarningListItem-title"},m(q(),{href:n?app.route.user(n):"#",className:"WarningListItem-author"},J()(n)," ",C()(n))),m("span",{class:"WarningListItem-strikes"},t.isHidden()?app.translator.trans("askvortsov-moderator-warnings.forum.warning_list_item.list_item_heading_hidden",{time:Q()(t.createdAt()),strikes:t.strikes()||0,money:t.money()||0}):app.translator.trans("askvortsov-moderator-warnings.forum.warning_list_item.list_item_heading",{time:Q()(t.createdAt()),strikes:t.strikes()||0,money:t.money()||0})),m("hr",null),m("ul",{className:"WarningListItem-info"},t.post()?m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("askvortsov-moderator-warnings.forum.warning_list_item.linked_post")),nt.component({post:t.post()})):"",m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("askvortsov-moderator-warnings.forum.warning_list_item.public_comment")),m("p",{class:"WarningListItem-comment"},m.trust(t.public_comment()))),app.session.user.canManageWarnings()&&t.private_comment()?m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("askvortsov-moderator-warnings.forum.warning_list_item.private_comment")),m("p",{class:"WarningListItem-comment"},m.trust(t.private_comment()))):"")))},r.elementAttrs=function(){var t=this.attrs.warning,n={};return n.className=(n.className||"")+" "+Y()({WarningListItem:!0,"WarningListItem--hidden":t.isHidden()}),n},n}(H());const mt=flarum.core.compat["helpers/listItems"];var ct=t.n(mt),ut=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.loading=!0,this.warnings=[],this.user=this.attrs.params.user,this.refresh()},r.view=function(){var t;return this.loading&&(t=R().component({size:"large"})),m("div",{className:"WarningList"},m("h1",{className:"WarningList-warnings"},this.strikeCount()?s().translator.trans("askvortsov-moderator-warnings.forum.warning_list.warnings",{strikes:this.strikeCount()||0}):s().translator.trans("askvortsov-moderator-warnings.forum.warning_list.warnings_no_strikes")),m("div",{class:"Warnings-toolbar"},m("ul",{className:"Warnings-toolbar-action"},ct()(this.actionItems().toArray()))),m("ul",{className:"WarningList-Warnings"},this.warnings.map((function(t){return m("li",{key:t.id(),"data-id":t.id()},it.component({warning:t}))})),!this.loading&&0===this.warnings.length&&m("label",null,s().translator.trans("askvortsov-moderator-warnings.forum.warning_list.no_warnings"))),m("div",{className:"WarningList-loadMore"},t))},r.actionItems=function(){var t=new(et());return s().session.user.canManageWarnings()&&t.add("create_warning",m(v(),{className:"Button Button--primary",onclick:this.handleOnClickCreate.bind(this)},s().translator.trans("askvortsov-moderator-warnings.forum.warning_list.add_button"))),t},r.strikeCount=function(){return this.warnings.filter((function(t){return!t.isHidden()})).map((function(t){return t.strikes()})).reduce((function(t,n){return t+n}),0)},r.parseResults=function(t){return[].push.apply(this.warnings,t),this.loading=!1,m.redraw(),t},r.refresh=function(){var t=this;return s().store.find("warnings",this.user.id()).catch((function(){})).then((function(n){t.warnings=[],t.parseResults(n)}))},r.handleOnClickCreate=function(t){t.preventDefault(),s().modal.show(U,j({callback:this.refresh.bind(this)},this.attrs.params))},n}(H()),lt=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.loadUser(m.route.param("username"))},r.content=function(){if(app.session.user&&(app.session.user.canViewWarnings()||this.user.id()===app.session.user.id()&&this.user.visibleWarningCount()>0))return m("div",{className:"WarningsUserPage"},ut.component({params:{user:this.user,sort:"newest"}}))},n}(M());function pt(){app.routes["user.warnings"]={path:"/u/:username/warnings",component:lt},(0,o.extend)(M().prototype,"navItems",(function(t){app.session.user&&(app.session.user.canViewWarnings()||this.user.id()===app.session.user.id()&&this.user.visibleWarningCount()>0)&&t.add("warnings",S().component({href:app.route("user.warnings",{username:this.user.slug()}),icon:"fas fa-exclamation-circle"},[app.translator.trans("askvortsov-moderator-warnings.forum.user.warnings"),this.user.visibleWarningCount()>0?m("span",{className:"Button-badge"},this.user.visibleWarningCount()):""]),10)}))}const dt=flarum.core.compat["models/Post"];var ht=t.n(dt);const ft=flarum.core.compat["components/CommentPost"];var gt=t.n(ft);const vt=flarum.core.compat["helpers/icon"];var wt=t.n(vt),bt=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.warning=this.attrs.warning},r.view=function(){return m(q(),{className:"WarningPreview",href:app.route("user.warnings",{username:this.warning.warnedUser().username()})},m(it,{warning:this.warning}))},n}(H()),yt=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.warning=this.attrs.warning},r.view=function(){return m("div",{className:"Post-warning"},m("span",{className:"Post-warning-summary"},wt()("fas fa-exclamation-circle"),this.warning.strikes()||this.warning.money()?app.translator.trans("askvortsov-moderator-warnings.forum.post.warning",{strikes:this.warning.strikes()||0,money:this.warning.money()||0,mod_username:C()(this.warning.addedByUser())}):app.translator.trans("askvortsov-moderator-warnings.forum.post.warning_no_strikes",{mod_username:C()(this.warning.addedByUser())})))},r.oncreate=function(n){var r=this;t.prototype.oncreate.call(this,n);var s,a=this.warning,e=function(){r.$(".Post-warning-preview").removeClass("in").one("transitionend",(function(){$(this).hide()}))},o=$('<ul class="Dropdown-menu Post-warning-preview fade"/>');this.$().append(o),this.$().children().hover((function(){clearTimeout(s),s=setTimeout((function(){!o.hasClass("in")&&o.is(":visible")||(m.render(o[0],m("li",{"data-id":a.id()},bt.component({warning:a}))),o.show(),setTimeout((function(){return o.off("transitionend").addClass("in")})))}),200)}),(function(){clearTimeout(s),s=setTimeout(e,250)})),$(".Post-warning").find(".Post-warning-summary a").hover((function(){$(".Post-warning").find('[data-number="'+$(this).data("number")+'"]').addClass("active")}),(function(){$(".Post-warning").find("[data-number]").removeClass("active")}))},n}(H()),_t=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.post=this.attrs.post},r.view=function(){return m("div",{className:"Post-warning-list"},this.attrs.post.warnings().map((function(t){return yt.component({warning:t})})))},n}(H());const kt=flarum.core.compat["components/Notification"];var Ct=function(t){function n(){return t.apply(this,arguments)||this}b(n,t);var r=n.prototype;return r.icon=function(){return"fas fa-exclamation-circle"},r.href=function(){return app.route("user.warnings",{username:app.session.user.username()})},r.content=function(){var t=this.attrs.notification.subject();return t.strikes()?app.translator.trans("askvortsov-moderator-warnings.forum.notifications.warning_text",{mod_username:C()(this.attrs.notification.fromUser()),strikes:t.strikes()||0}):app.translator.trans("askvortsov-moderator-warnings.forum.notifications.warning_no_strikes_text",{mod_username:C()(this.attrs.notification.fromUser())})},n}(t.n(kt)());const Nt=flarum.core.compat["utils/computed"];var Wt=t.n(Nt),Pt=function(t){function n(){return t.apply(this,arguments)||this}return b(n,t),n}(l());Object.assign(Pt.prototype,{id:l().attribute("id"),public_comment:l().attribute("public_comment"),private_comment:l().attribute("private_comment"),strikes:l().attribute("strikes"),money:l().attribute("money"),createdAt:l().attribute("createdAt",l().transformDate),isHidden:Wt()("hiddenAt",(function(t){return!!t})),hiddenAt:l().attribute("hiddenAt",l().transformDate),warnedUser:l().hasOne("warnedUser"),hiddenByUser:l().hasOne("hiddenByUser"),addedByUser:l().hasOne("addedByUser"),post:l().hasOne("post")}),s().initializers.add("askvortsov/flarum-moderator-warnings",(function(t){t.store.models.warnings=Pt,c().prototype.canViewWarnings=l().attribute("canViewWarnings"),c().prototype.canManageWarnings=l().attribute("canManageWarnings"),c().prototype.canDeleteWarnings=l().attribute("canDeleteWarnings"),c().prototype.visibleWarningCount=l().attribute("visibleWarningCount"),(0,o.extend)(d(),"moderationControls",(function(t,n){s().session.user&&s().session.user.canManageWarnings()&&t.add("warning",m(v(),{icon:"fas fa-exclamation-circle",onclick:function(){return s().modal.show(U,{callback:function(){location.reload()},user:n.user(),post:n})}},s().translator.trans("askvortsov-moderator-warnings.forum.post_controls.warning_button")))})),(0,o.extend)(f(),"moderationControls",(function(t,n){s().session.user&&s().session.user.canManageWarnings()&&t.add("warning",m(v(),{icon:"fas fa-exclamation-circle",onclick:function(){return s().modal.show(U,{callback:function(){location.reload()},user:n})}},s().translator.trans("askvortsov-moderator-warnings.forum.post_controls.warning_button")))})),pt(),ht().prototype.warnings=l().hasMany("warnings"),(0,o.extend)(gt().prototype,"footerItems",(function(t){var n=this.attrs.post;n.warnings()&&t.add("warnings",_t.component({post:n}))})),t.notificationComponents.warning=Ct,(0,o.extend)(e().prototype,"notificationTypes",(function(n){n.add("warning",{name:"warning",icon:"fas fa-exclamation-circle",label:t.translator.trans("askvortsov-moderator-warnings.forum.settings.warning_notification_label")})}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map